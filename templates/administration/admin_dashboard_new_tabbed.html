{% extends 'base.html' %}
{% load i18n %}
{% load static %}
{% block title %}Admin Dashboard - LearnSphere{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/admin_management.css' %}">
<style>
    .stat-card {
        background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
        border-left: 4px solid #667eea;
        transition: transform 0.3s ease;
    }

    .stat-card:hover {
        transform: translateY(-5px);
    }

    .stat-icon {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.8rem;
    }

    .chart-container {
        position: relative;
        height: 300px;
    }

    .quick-action-btn {
        border-radius: 15px;
        padding: 15px 25px;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    .quick-action-btn:hover {
        transform: scale(1.05);
        box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="fw-bold"><i class="bi bi-speedometer2 me-2"></i>{% trans "Admin Dashboard" %}</h1>
        <div>
            <a href="{% url 'admin:index' %}" class="btn btn-outline-primary me-2"><i class="bi bi-gear me-2"></i>Django
                Admin</a>
            <a href="{% url 'home' %}" class="btn btn-outline-secondary"><i class="bi bi-house me-2"></i>{% trans
                "Asosiy sahifa" %}</a>
        </div>
    </div>

    <!-- Tab Navigation -->
    <ul class="nav nav-tabs admin-tabs" id="adminTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="dashboard-tab" data-bs-toggle="tab" data-bs-target="#dashboard"
                type="button" role="tab">
                <i class="bi bi-speedometer2 me-2"></i>Dashboard
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="users-tab" data-bs-toggle="tab" data-bs-target="#users" type="button"
                role="tab">
                <i class="bi bi-people me-2"></i>Foydalanuvchilar
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="classes-tab" data-bs-toggle="tab" data-bs-target="#classes" type="button"
                role="tab">
                <i class="bi bi-building me-2"></i>Sinflar
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="subjects-tab" data-bs-toggle="tab" data-bs-target="#subjects" type="button"
                role="tab">
                <i class="bi bi-book me-2"></i>Fanlar
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="grades-tab" data-bs-toggle="tab" data-bs-target="#grades" type="button"
                role="tab">
                <i class="bi bi-mortarboard me-2"></i>Baholar
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="attendance-tab" data-bs-toggle="tab" data-bs-target="#attendance" type="button"
                role="tab">
                <i class="bi bi-calendar-check me-2"></i>Davomat
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="teachers-tab" data-bs-toggle="tab" data-bs-target="#teachers" type="button"
                role="tab">
                <i class="bi bi-person-badge me-2"></i>O'qituvchilar
            </button>
        </li>
    </ul>

    <!-- Tab Content -->
    <div class="tab-content mt-4" id="adminTabContent">
        <!-- Dashboard Tab -->
        <div class="tab-pane fade show active" id="dashboard" role="tabpanel">
            {% include 'administration/partials/dashboard_stats.html' %}
        </div>

        <!-- Users Tab -->
        <div class="tab-pane fade" id="users" role="tabpanel">
            {% include 'administration/partials/users_management.html' %}
        </div>

        <!-- Classes Tab -->
        <div class="tab-pane fade" id="classes" role="tabpanel">
            {% include 'administration/partials/classes_management.html' %}
        </div>

        <!-- Subjects Tab -->
        <div class="tab-pane fade" id="subjects" role="tabpanel">
            {% include 'administration/partials/subjects_management.html' %}
        </div>

        <!-- Grades Tab -->
        <div class="tab-pane fade" id "grades" role="tabpanel">
            {% include 'administration/partials/grades_management.html' %}
        </div>

        <!-- Attendance Tab -->
        <div class="tab-pane fade" id="attendance" role="tabpanel">
            {% include 'administration/partials/attendance_management.html' %}
        </div>

        <!-- Teachers Tab -->
        <div class="tab-pane fade" id="teachers" role="tabpanel">
            {% include 'administration/partials/teachers_management.html' %}
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="{% static 'js/admin_management.js' %}"></script>
<script>
    // Load tab-specific content when tab is shown
    document.querySelectorAll('[data-bs-toggle="tab"]').forEach(tab => {
        tab.addEventListener('shown.bs.tab', function (e) {
            const targetId = e.target.getAttribute('data-bs-target').replace('#', '');
            console.log('Tab shown:', targetId);

            // Trigger load events for specific tabs
            if (targetId === 'users' && !window.usersLoaded) {
                loadUsers();
                window.usersLoaded = true;
            } else if (targetId === 'classes' && !window.classesLoaded) {
                loadClasses();
                window.classesLoaded = true;
            } else if (targetId === 'subjects' && !window.subjectsLoaded) {
                loadSubjects();
                window.subjectsLoaded = true;
            } else if (targetId === 'grades' && !window.gradesLoaded) {
                loadGrades();
                window.gradesLoaded = true;
            } else if (targetId === 'attendance' && !window.attendanceLoaded) {
                loadAttendance();
                window.attendanceLoaded = true;
            } else if (targetId === 'teachers' && !window.teachersLoaded) {
                loadTeacherAssignments();
                window.teachersLoaded = true;
            }
        });
    });

    // Load functions will be implemented in partial templates
    function loadUsers() { console.log('Loading users...'); }
    function loadClasses() { console.log('Loading classes...'); }
    function loadSubjects() { console.log('Loading subjects...'); }
    function loadGrades() { console.log('Loading grades...'); }
    function loadAttendance() { console.log('Loading attendance...'); }
    function loadTeacherAssignments() { console.log('Loading teacher assignments...'); }
</script>
{% endblock %}