{% extends 'base.html' %}

{% block title %}Testni Tahrirlash - {{ quiz.title }}{% endblock %}

{% block content %}
<div class="row mb-5">
    <div class="col-12">
        <div class="glass-card p-4">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <span class="badge bg-primary bg-opacity-10 text-primary rounded-pill mb-2">
                        {{ quiz.subject.name }}
                    </span>
                    <h2 class="fw-bold mb-0">{{ quiz.title }}</h2>
                    <p class="text-muted mb-0">
                        <i class="bi bi-clock me-1"></i> {{ quiz.time_limit }} daqiqa |
                        <i class="bi bi-question-circle me-1"></i> {{ questions.count }} ta savol
                    </p>
                </div>
                <div>
                    <a href="{% url 'quiz_detail' quiz.id %}" class="btn btn-outline-primary rounded-pill me-2">
                        <i class="bi bi-eye"></i> Ko'rish
                    </a>
                    <a href="{% url 'quiz_list' %}" class="btn btn-light rounded-pill">
                        <i class="bi bi-check-lg"></i> Yakunlash
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- Manual Question Add -->
    <div class="col-lg-6 mb-4">
        <div class="glass-card p-4 h-100">
            <h4 class="fw-bold mb-3"><i class="bi bi-plus-circle me-2"></i> Savol Qo'shish</h4>
            <form method="post">
                {% csrf_token %}
                <input type="hidden" name="add_question" value="1">

                <div class="mb-3">
                    <label class="form-label fw-bold">Savol Matni</label>
                    <textarea class="form-control rounded-3" name="question_text" rows="2" required></textarea>
                </div>

                <div class="mb-3">
                    <label class="form-label fw-bold">Ball</label>
                    <input type="number" class="form-control rounded-3" name="points" value="1" min="1" required>
                </div>

                <label class="form-label fw-bold">Javob Variantlari</label>
                <div class="input-group mb-2">
                    <div class="input-group-text">
                        <input class="form-check-input mt-0" type="radio" name="correct_option" value="1" required>
                    </div>
                    <input type="text" class="form-control" name="option_1" placeholder="Variant A" required>
                </div>
                <div class="input-group mb-2">
                    <div class="input-group-text">
                        <input class="form-check-input mt-0" type="radio" name="correct_option" value="2">
                    </div>
                    <input type="text" class="form-control" name="option_2" placeholder="Variant B" required>
                </div>
                <div class="input-group mb-2">
                    <div class="input-group-text">
                        <input class="form-check-input mt-0" type="radio" name="correct_option" value="3">
                    </div>
                    <input type="text" class="form-control" name="option_3" placeholder="Variant C" required>
                </div>
                <div class="input-group mb-3">
                    <div class="input-group-text">
                        <input class="form-check-input mt-0" type="radio" name="correct_option" value="4">
                    </div>
                    <input type="text" class="form-control" name="option_4" placeholder="Variant D" required>
                </div>

                <button type="submit" class="btn btn-primary w-100 rounded-pill">
                    Qo'shish
                </button>
            </form>
        </div>
    </div>

    <!-- Excel Import -->
    <div class="col-lg-6 mb-4">
        <div class="glass-card p-4 h-100">
            <h4 class="fw-bold mb-3"><i class="bi bi-file-earmark-excel me-2"></i> Exceldan Yuklash</h4>
            <p class="text-muted small">
                Excel fayl quyidagi ustunlarga ega bo'lishi kerak:<br>
                <code>Question</code>, <code>Option A</code>, <code>Option B</code>, <code>Option C</code>,
                <code>Option D</code>, <code>Correct Answer</code> (A, B, C yoki D)
            </p>

            <form method="post" enctype="multipart/form-data" class="mt-4">
                {% csrf_token %}
                <input type="hidden" name="import_excel" value="1">

                <div class="mb-3">
                    <input type="file" class="form-control" name="excel_file" accept=".xlsx, .xls" required>
                </div>

                <button type="submit" class="btn btn-success w-100 rounded-pill text-white">
                    <i class="bi bi-upload me-2"></i> Yuklash
                </button>
            </form>

            <hr class="my-4">

            <h5 class="fw-bold mb-3">Mavjud Savollar ({{ questions.count }})</h5>
            <div class="list-group list-group-flush overflow-auto" style="max-height: 300px;">
                {% for question in questions %}
                <div class="list-group-item bg-transparent px-0">
                    <div class="d-flex justify-content-between">
                        <span class="fw-bold text-truncate" style="max-width: 80%;">{{ forloop.counter }}. {{
                            question.text }}</span>
                        <span class="badge bg-secondary rounded-pill">{{ question.points }} ball</span>
                    </div>
                </div>
                {% empty %}
                <p class="text-muted text-center my-3">Savollar yo'q</p>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endblock %}